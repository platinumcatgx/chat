<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <script src="../js/jquery-3.3.1.js"></script>
    <!-- Vue.JS -->
    <script src="../js/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <!-- LayUI -->
    <link rel="stylesheet" href="../layui/css/layui.css">
    <script src="../layui/layui.js"></script>

    <!-- 我自己的 -->
    <link rel="stylesheet" href="../css/chat.css">

    <title>聊天</title>
</head>
<body>
        <div id="app" class="contianer">

            <div class="showMsg"><!--文本域:显示聊天消息-->
                <p>

                </p>
                <div class="info">
                    <p>
                        您好, 欢迎和我聊天!
                    </p>
                </div>
            </div>

            <div class="sendMsg"><!--发送消息-->
                <textarea id="sendInfo"></textarea>
            </div>
            <div class="btn">
                <button id="sendMessage">发送消息</button>
                <button id="Client">清空消息</button>
            </div>
        </div>

    <script src="../js/chat.js"></script>
    <script type="text/javascript">
        $(function () {
            $("#sendMessage").click(function () {
                //获取发送消息
                var msg = $("#sendInfo").val()
                if (msg == ' ' || msg == '') return;
                $.ajax({
                    type: "get",
                    url: "http://i.itpk.cn/api.php?",
                    data: "api_key=0597091c626d853c47417f823b04c868&"+"api_secret=zw5q1wexzz0d"+"&question=" + msg,
                    success: function (response) {
                        //将收到的消息以固定的形式显示
                        //我的消息
                        var myMsg = "<p>"+new Date().toLocaleString()+" 我</p>"+"<div class=\"info\" > " + msg + " </div>"
                        //机器人的消息
                        var robotMsg = "<p>"+new Date().toLocaleString()+" 机器人</p><div class=\"info\"><p>" + response + "</p></div>"

                        //根据class="showMsg"获取该div
                        $(".showMsg").append(myMsg).append(robotMsg)

                        //设置滚动条默认在最下面,获取DIV滚动的高度
                        var div = document.getElementsByClassName("showMsg")[0];
                        //滚动条与顶部的距离
                        div.scrollTop = div.scrollHeight;
                    },
                    error: (function (error) {
                        alert("异常" + error)
                    })
                })
                $("#sendInfo").val("")

            })
            //清空按钮的单机事件
            $("#Client").click(function () {
                $("#sendInfo").val("")
            });
            //清空按钮的回车按下事件
            $("#Client").keyup(function (event) {
                alert(event.keyCode)
                if (event.keyCode == '13') {
                    $("#sendInfo").click()
                }
            })
        })

    </script>

</body>
</html>